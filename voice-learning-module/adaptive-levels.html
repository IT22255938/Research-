<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceLearn Adaptive Levels - Dynamic Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --light-bg: #f5f7fa;
            --border-color: #e0e0e0;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }
        
        .app-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .nav-buttons button {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .nav-buttons button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .level-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .level-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .current-level {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .level-title {
            font-size: 1.8em;
            color: var(--text-dark);
            margin-bottom: 20px;
        }
        
        .level-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .info-box {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .info-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .progress-section {
            margin-top: 30px;
        }
        
        .progress-title {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 15px;
        }
        
        .level-progress-bar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .level-node {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .level-node.locked {
            background: #ccc;
            opacity: 0.5;
        }
        
        .level-node.available {
            background: var(--warning);
        }
        
        .level-node.current {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.1);
        }
        
        .level-node.completed {
            background: var(--success);
        }
        
        .level-node:hover {
            transform: scale(1.1);
        }
        
        .arrow {
            font-size: 2em;
            color: var(--primary);
        }
        
        .difficulty-tracker {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .tracker-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        
        .difficulty-chart {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .difficulty-bar {
            text-align: center;
        }
        
        .difficulty-name {
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .difficulty-name.easy {
            color: var(--success);
        }
        
        .difficulty-name.medium {
            color: var(--warning);
        }
        
        .difficulty-name.hard {
            color: var(--danger);
        }
        
        .bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .bar-fill.easy {
            background: var(--success);
        }
        
        .bar-fill.medium {
            background: var(--warning);
        }
        
        .bar-fill.hard {
            background: var(--danger);
        }
        
        .recommendations {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--success);
            margin-top: 20px;
        }
        
        .rec-title {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .rec-text {
            color: #558b2f;
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn.secondary {
            background: var(--text-light);
        }
        
        .btn.secondary:hover {
            background: var(--text-dark);
        }
        
        .achievement-unlock {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            margin-top: 20px;
            display: none;
        }
        
        .achievement-unlock.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .achievement-title {
            color: #e65100;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .achievement-text {
            color: #bf360c;
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="logo">üéÆ Adaptive Learning Levels</div>
        <div class="nav-buttons">
            <button onclick="window.location.href='gamification.html'">‚Üê Back to Dashboard</button>
            <button onclick="window.location.href='analytics.html'">üìä Analytics</button>
        </div>
    </div>

    <div class="container">
        <div class="level-container">
            <div class="level-header">
                <div class="current-level" id="levelDisplay">1</div>
                <div class="level-title" id="levelTitle">Beginner</div>
                <p style="color: #666; margin-top: 10px;" id="levelDescription">Master the fundamentals of learning</p>
            </div>

            <div class="level-info">
                <div class="info-box">
                    <div class="info-label">Current Accuracy</div>
                    <div class="info-value" id="currentAccuracy">0%</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Activities at Level</div>
                    <div class="info-value" id="levelActivities">0</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Accuracy Needed</div>
                    <div class="info-value" id="accuracyNeeded">85%</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Progress to Next</div>
                    <div class="info-value" id="progressPercent">0%</div>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-title">üìà Your Progress Through Levels</div>
                <div class="level-progress-bar" id="levelProgressBar">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <div class="difficulty-tracker">
                <div class="tracker-title">üìä Current Performance by Difficulty</div>
                <div class="difficulty-chart">
                    <div class="difficulty-bar">
                        <div class="difficulty-name easy">üü¢ Easy</div>
                        <div class="bar">
                            <div class="bar-fill easy" id="easyBar" style="width: 0%;"></div>
                        </div>
                        <div style="font-size: 0.85em; color: #666;" id="easyPercentage">0%</div>
                    </div>
                    <div class="difficulty-bar">
                        <div class="difficulty-name medium">üü° Medium</div>
                        <div class="bar">
                            <div class="bar-fill medium" id="mediumBar" style="width: 0%;"></div>
                        </div>
                        <div style="font-size: 0.85em; color: #666;" id="mediumPercentage">0%</div>
                    </div>
                    <div class="difficulty-bar">
                        <div class="difficulty-name hard">üî¥ Hard</div>
                        <div class="bar">
                            <div class="bar-fill hard" id="hardBar" style="width: 0%;"></div>
                        </div>
                        <div style="font-size: 0.85em; color: #666;" id="hardPercentage">0%</div>
                    </div>
                </div>
            </div>

            <div class="recommendations" id="recommendationBox">
                <div class="rec-title">üí° Adaptive Recommendation</div>
                <div class="rec-text" id="recommendationText">
                    Complete more activities to get personalized recommendations!
                </div>
            </div>

            <div class="achievement-unlock" id="achievementBox">
                <div class="achievement-title" id="achievementTitle">üèÜ Level Unlocked!</div>
                <div class="achievement-text" id="achievementText">You've unlocked the next level!</div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="window.location.href='gamification.html'">üéÆ Start Learning</button>
                <button class="btn secondary" onclick="resetAdaptiveProgress()">üîÑ Reset Progress</button>
            </div>
        </div>
    </div>

    <script>
        // Level system configuration
        const LEVELS = [
            { level: 1, name: 'Beginner', minAccuracy: 0, maxAccuracy: 60, description: 'Master the fundamentals' },
            { level: 2, name: 'Novice', minAccuracy: 60, maxAccuracy: 70, description: 'Growing confidence' },
            { level: 3, name: 'Intermediate', minAccuracy: 70, maxAccuracy: 80, description: 'Building skills' },
            { level: 4, name: 'Advanced', minAccuracy: 80, maxAccuracy: 85, description: 'Challenging yourself' },
            { level: 5, name: 'Expert', minAccuracy: 85, maxAccuracy: 90, description: 'Mastering the content' },
            { level: 6, name: 'Master', minAccuracy: 90, maxAccuracy: 95, description: 'Excellence level' },
            { level: 7, name: 'Legend', minAccuracy: 95, maxAccuracy: 100, description: 'Peak performance' }
        ];

        const LEVEL_THRESHOLDS = {
            1: 60,   // 60% accuracy to reach level 2
            2: 70,   // 70% accuracy to reach level 3
            3: 80,   // 80% accuracy to reach level 4
            4: 85,   // 85% accuracy to reach level 5
            5: 90,   // 90% accuracy to reach level 6
            6: 95,   // 95% accuracy to reach level 7
            7: 100   // Level 7 is max
        };

        // Get user's current level and stats
        function loadAdaptiveData() {
            const stats = JSON.parse(localStorage.getItem('voiceLearnStats') || '{}');
            const adaptiveData = JSON.parse(localStorage.getItem('adaptiveData') || '{}');
            
            // Initialize if not exists
            if (!adaptiveData.currentLevel) {
                adaptiveData.currentLevel = 1;
                adaptiveData.levelHistory = [1];
                adaptiveData.lastLevelUp = null;
            }

            // Calculate current difficulty recommendation
            updateDifficultyRecommendation(stats, adaptiveData);
            
            // Update UI
            updateLevelDisplay(adaptiveData, stats);
            updateProgressBar(adaptiveData);
            updateDifficultyBars(stats);
            updateRecommendations(stats, adaptiveData);
            
            // Check for level up
            checkLevelUp(stats, adaptiveData);
        }

        function updateDifficultyRecommendation(stats, adaptiveData) {
            const easyAccuracy = stats.easyTotal > 0 ? (stats.easyCorrect / stats.easyTotal) * 100 : 0;
            const mediumAccuracy = stats.mediumTotal > 0 ? (stats.mediumCorrect / stats.mediumTotal) * 100 : 0;
            const hardAccuracy = stats.hardTotal > 0 ? (stats.hardCorrect / stats.hardTotal) * 100 : 0;
            
            // Auto-recommend difficulty based on performance
            let suggestedDifficulty = 'easy';
            if (easyAccuracy >= 85) suggestedDifficulty = 'medium';
            if (mediumAccuracy >= 85) suggestedDifficulty = 'hard';
            
            adaptiveData.suggestedDifficulty = suggestedDifficulty;
            localStorage.setItem('adaptiveData', JSON.stringify(adaptiveData));
        }

        function updateLevelDisplay(adaptiveData, stats) {
            const currentLevel = adaptiveData.currentLevel || 1;
            const levelData = LEVELS[currentLevel - 1];
            
            document.getElementById('levelDisplay').textContent = currentLevel;
            document.getElementById('levelTitle').textContent = levelData.name + ' üéØ';
            document.getElementById('levelDescription').textContent = levelData.description;
            
            // Calculate accuracy
            const accuracy = stats.totalAttempts > 0
                ? Math.round((stats.correctAnswers / stats.totalAttempts) * 100)
                : 0;
            document.getElementById('currentAccuracy').textContent = accuracy + '%';
            
            // Activities at this level
            const levelActivities = adaptiveData.levelActivities ? adaptiveData.levelActivities[currentLevel] || 0 : 0;
            document.getElementById('levelActivities').textContent = levelActivities;
            
            // Accuracy needed for next level
            const nextThreshold = LEVEL_THRESHOLDS[currentLevel] || 100;
            document.getElementById('accuracyNeeded').textContent = nextThreshold + '%';
            
            // Progress to next level
            const progress = Math.min(Math.round((accuracy / nextThreshold) * 100), 100);
            document.getElementById('progressPercent').textContent = progress + '%';
        }

        function updateProgressBar(adaptiveData) {
            const progressBar = document.getElementById('levelProgressBar');
            let html = '';
            
            for (let i = 1; i <= LEVELS.length; i++) {
                const levelCompleted = (adaptiveData.levelHistory || []).includes(i);
                const isCurrent = i === adaptiveData.currentLevel;
                
                let className = 'level-node ';
                if (i > adaptiveData.currentLevel && !levelCompleted) {
                    className += 'locked';
                } else if (isCurrent) {
                    className += 'current';
                } else if (levelCompleted) {
                    className += 'completed';
                } else {
                    className += 'available';
                }
                
                html += `<div class="${className}" title="Level ${i}: ${LEVELS[i-1].name}">${i}</div>`;
                
                if (i < LEVELS.length) {
                    html += '<div class="arrow">‚Üí</div>';
                }
            }
            
            progressBar.innerHTML = html;
        }

        function updateDifficultyBars(stats) {
            const easyAccuracy = stats.easyTotal > 0 ? (stats.easyCorrect / stats.easyTotal) * 100 : 0;
            const mediumAccuracy = stats.mediumTotal > 0 ? (stats.mediumCorrect / stats.mediumTotal) * 100 : 0;
            const hardAccuracy = stats.hardTotal > 0 ? (stats.hardCorrect / stats.hardTotal) * 100 : 0;
            
            // Update Easy
            document.getElementById('easyBar').style.width = easyAccuracy + '%';
            document.getElementById('easyBar').textContent = Math.round(easyAccuracy) + '%';
            document.getElementById('easyPercentage').textContent = Math.round(easyAccuracy) + '%';
            
            // Update Medium
            document.getElementById('mediumBar').style.width = mediumAccuracy + '%';
            document.getElementById('mediumBar').textContent = Math.round(mediumAccuracy) + '%';
            document.getElementById('mediumPercentage').textContent = Math.round(mediumAccuracy) + '%';
            
            // Update Hard
            document.getElementById('hardBar').style.width = hardAccuracy + '%';
            document.getElementById('hardBar').textContent = Math.round(hardAccuracy) + '%';
            document.getElementById('hardPercentage').textContent = Math.round(hardAccuracy) + '%';
        }

        function updateRecommendations(stats, adaptiveData) {
            const accuracy = stats.totalAttempts > 0
                ? (stats.correctAnswers / stats.totalAttempts) * 100
                : 0;
            const currentLevel = adaptiveData.currentLevel || 1;
            const nextThreshold = LEVEL_THRESHOLDS[currentLevel] || 100;
            
            let recommendation = '';
            
            if (stats.totalAttempts === 0) {
                recommendation = 'üöÄ Start your learning journey! Choose an activity and select your preferred difficulty level.';
            } else if (accuracy < 50) {
                recommendation = 'üìö Focus on Easy difficulty to build confidence. You\'re doing great - consistency is key!';
            } else if (accuracy < nextThreshold - 10) {
                const difference = Math.round(nextThreshold - accuracy);
                recommendation = `‚ö° You\'re close! ${difference}% more accuracy and you\'ll unlock the next level! Try a bit of Medium difficulty.`;
            } else if (accuracy < nextThreshold) {
                const difference = Math.round(nextThreshold - accuracy);
                recommendation = `üî• Almost there! Just ${difference}% more to reach the next level! Push for it!`;
            } else {
                recommendation = 'üèÜ Congratulations! You\'ve mastered this level. You\'re ready for the next challenge!';
            }
            
            document.getElementById('recommendationText').textContent = recommendation;
        }

        function checkLevelUp(stats, adaptiveData) {
            const accuracy = stats.totalAttempts > 0
                ? (stats.correctAnswers / stats.totalAttempts) * 100
                : 0;
            const currentLevel = adaptiveData.currentLevel || 1;
            const nextThreshold = LEVEL_THRESHOLDS[currentLevel];
            
            if (accuracy >= nextThreshold && currentLevel < LEVELS.length) {
                // Level up!
                adaptiveData.currentLevel = currentLevel + 1;
                adaptiveData.levelHistory = adaptiveData.levelHistory || [];
                if (!adaptiveData.levelHistory.includes(currentLevel + 1)) {
                    adaptiveData.levelHistory.push(currentLevel + 1);
                    adaptiveData.lastLevelUp = new Date().toISOString();
                    
                    // Show achievement
                    showAchievement(currentLevel + 1);
                }
                
                localStorage.setItem('adaptiveData', JSON.stringify(adaptiveData));
            }
        }

        function showAchievement(newLevel) {
            const levelData = LEVELS[newLevel - 1];
            const achievementBox = document.getElementById('achievementBox');
            const achievementTitle = document.getElementById('achievementTitle');
            const achievementText = document.getElementById('achievementText');
            
            achievementTitle.textContent = `üèÜ Level ${newLevel} Unlocked: ${levelData.name}!`;
            achievementText.textContent = `You've reached ${levelData.name} level! ${levelData.description}`;
            achievementBox.classList.add('show');
            
            // Play celebration sound
            celebrateUnlock();
        }

        function celebrateUnlock() {
            // Use Web Speech API for celebration
            const msg = new SpeechSynthesisUtterance('Congratulations! You unlocked a new level!');
            msg.rate = 0.9;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(msg);
        }

        function resetAdaptiveProgress() {
            if (confirm('‚ö†Ô∏è This will reset your adaptive progress. Are you sure?')) {
                localStorage.removeItem('adaptiveData');
                location.reload();
            }
        }

        // Load data on page load
        window.addEventListener('load', function() {
            loadAdaptiveData();
            // Reload every 5 seconds to show real-time updates
            setInterval(loadAdaptiveData, 5000);
        });
    </script>
</body>
</html>
